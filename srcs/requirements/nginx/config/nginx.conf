# user       			www-data;
# worker_processes 		5;  ## Default: 1
# error_log				logs/error.log;
# pid        			logs/nginx.pid;
# worker_rlimit_nofile	8192;

events {
  worker_connections  1024;
}

http {
	sendfile		on;
	tcp_nopush		on;
	tcp_nodelay on;

	include			conf/mime.types;
	include			/etc/nginx/proxy.conf;
	include			/etc/nginx/fastcgi.conf;
	default_type	application/octet-stream;

	ssl_protocols				TLSv1.2 TLSv1.3;
	ssl_prefer_server_ciphers	on;


	access_log		logs/access.log  main;
	error_log		/var/log/nginx/error.log;

	server {
		listen       		443 ssl; # listen on port 443 for incoming ipV4 connections
		listen       		[::]:443 ssl; # listen on port 443 for incoming ipV6 connections
		server_name  		${DOMAIN_NAME};

		# SSL/TLS Config
		ssl_certificate		/etc/ssl/private/nginx-selfsigned.crt;
		ssl_certificate_key	/etc/ssl/private/nginx-selfsigned.key;

		# Redirect to wordpress website
		root         		/var/www/wordpress;
		index				index.php index.html index.htm index.nginx-debian.html;
		error_page			497 https://$host:$server_port$request_uri;

		# For non .php requests
		location / {
			try_files		$uri $uri/ =404;
		}

		# For .php requests
		location ~ \.php$ {
			fastcgi_split_path_info ^(.+\.php)(/.+)$;
			fastcgi_pass	wordpress:9000;
			fastcgi_index	index.php;
			include			fastcgi_params;
			fastcgi_param	SCRIPT_FILENAME $document_root$fastcgi_script_name;
			fastcgi_param	PATH_INFO $fastcgi_path_info;
		}
	}
	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}